<!DOCTYPE html>
<html>
  <head>
    <title>ลงทะเบียนรีแมพ</title>
    <style>
      body {
        background-color: #000;
        color: gold;
        font-family: 'Arial', sans-serif;
        padding: 20px;
      }
      input, button {
        padding: 10px;
        margin: 10px 0;
        width: 100%;
        background-color: #111;
        border: 1px solid gold;
        color: gold;
        border-radius: 8px;
      }
      button {
        background-color: gold;
        color: black;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2>ลงทะเบียนรับประกัน</h2>
    <form id="registerForm">
      <input type="text" id="name" placeholder="ชื่อ-สกุล" required />
      <input type="tel" id="phone" placeholder="เบอร์โทร" required />
      <input type="text" id="plate" placeholder="เลขทะเบียนรถ" required />
      <input type="hidden" id="date" />
      <button type="submit">บันทึกข้อมูล</button>
    </form>
    <p id="message"></p>
    <script>
      const liffId = '2007499630-0J5jPaaP';
      let userId = '';

      async function main() {
        await liff.init({ liffId });
        if (!liff.isLoggedIn()) liff.login();
        const profile = await liff.getProfile();
        userId = profile.userId;
        document.getElementById("date").value = new Date().toISOString().split("T")[0];
      }

      document.getElementById("registerForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const plate = document.getElementById("plate").value;
        const date = document.getElementById("date").value;

        const response = await fetch(
          'https://script.google.com/macros/s/AKfycbz2Kz_HPUAAu2KWUxxwBfrGVNXA6E9ecj2xb7iR-1Oz0DDUVD7MYhxM4rpf0_m1qbnCOw/exec',
          {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId, name, phone, plate, date })
          }
        );

        document.getElementById("message").innerText = "✅ บันทึกข้อมูลเรียบร้อยแล้ว";
        liff.sendMessages([
          {
            type: "flex",
            altText: "ลงทะเบียนสำเร็จ",
            contents: {
              type: "bubble",
              body: {
                type: "box",
                layout: "vertical",
                contents: [
                  { type: "text", text: "ลงทะเบียนสำเร็จ", weight: "bold", size: "lg", color: "#FFD700" },
                  { type: "text", text: `ชื่อ: ${name}`, color: "#FFF" },
                  { type: "text", text: `เบอร์: ${phone}`, color: "#FFF" },
                  { type: "text", text: `ทะเบียน: ${plate}`, color: "#FFF" },
                  { type: "text", text: `วันที่: ${date}`, color: "#FFF" }
                ]
              }
            }
          }
        ]);
        liff.closeWindow();
      });

      main();
    </script>
  </body>
</html>
