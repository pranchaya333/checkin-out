<!DOCTYPE html>
<html>
  <head>
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡πÅ‡∏°‡∏û</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body {
        background-color: #000;
        color: gold;
        font-family: 'Arial', sans-serif;
        padding: 20px;
        max-width: 480px;
        margin: auto;
      }
      h2 {
        text-align: center;
      }
      input, button {
        display: block;
        width: 100%;
        padding: 12px;
        margin: 12px 0;
        background-color: #111;
        border: 1px solid gold;
        color: gold;
        border-radius: 8px;
        font-size: 16px;
      }
      button {
        background-color: gold;
        color: black;
        font-weight: bold;
      }
      #message {
        text-align: center;
        font-size: 18px;
        margin-top: 20px;
      }
      #closeBtn {
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h2>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</h2>
    <form id="registerForm">
      <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required />
      <input type="tel" id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" required />
      <input type="text" id="plate" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ" required />
      <input type="hidden" id="date" />
      <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>

    <p id="message"></p>
    <button id="closeBtn" onclick="liff.closeWindow()">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</button>

    <script>
      const liffId = '2007499630-0J5jPaaP'; // üîÅ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      let userId = '';

      async function main() {
        await liff.init({ liffId });
        if (!liff.isLoggedIn()) liff.login();
        const profile = await liff.getProfile();
        userId = profile.userId;

        // ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        document.getElementById("date").value = new Date().toISOString().split("T")[0];
      }

      document.getElementById("registerForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const plate = document.getElementById("plate").value;
        const date = document.getElementById("date").value;

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
        await fetch(
          'https://script.google.com/macros/s/AKfycbz2Kz_HPUAAu2KWUxxwBfrGVNXA6E9ecj2xb7iR-1Oz0DDUVD7MYhxM4rpf0_m1qbnCOw/exec',
          {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId, name, phone, plate, date })
          }
        );

        // ‡∏™‡πà‡∏á Flex Message ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
        await liff.sendMessages([
          {
            type: "flex",
            altText: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
            contents: {
              type: "bubble",
              size: "mega",
              body: {
                type: "box",
                layout: "vertical",
                spacing: "md",
                contents: [
                  {
                    type: "text",
                    text: "‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
                    weight: "bold",
                    size: "lg",
                    color: "#FFD700"
                  },
                  {
                    type: "text",
                    text: `‡∏ä‡∏∑‡πà‡∏≠: ${name}`,
                    color: "#FFFFFF"
                  },
                  {
                    type: "text",
                    text: `‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${phone}`,
                    color: "#FFFFFF"
                  },
                  {
                    type: "text",
                    text: `‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${plate}`,
                    color: "#FFFFFF"
                  },
                  {
                    type: "text",
                    text: `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date}`,
                    color: "#FFFFFF"
                  }
                ]
              }
            }
          }
        ]);

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô + ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
        document.getElementById("message").innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
        document.getElementById("closeBtn").style.display = "block";
      });

      main();
    </script>
  </body>
</html>
